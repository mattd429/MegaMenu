'use strict'
const fs = require('fs');
const path = require('path');

const COMMONJS_BANNER = '// This file is autogenerated via the `commonjs` Grunt task. You can require() this file in a CommonJS environment.\n';

module.exports.generateCommonJSModule = (grunt, srcFiles, destFilepath) => {

  const destDir = path.dirname(destFilepath);
  
  function srcPathToDestRequire(srcFilepath) {
    const requirePath = path.relative(destDir, srcFilepath).replace(/\\/g, '/');
    return 'require(\'' + requirePath + '\')';
  }
  
  const moduleOutputJs = COMMONJS_BANNER + srcFiles.map(srcPAthToDestRequire).join('\n');
  try {
    fs.writeFileSync(destFilePath, moduleOutputsJs);
  }
  catch (err) {
    grunt.fail.warn(err);
  }
  grunt.log.writeln('File ' + destFilepath.cyan + ' created.');
  
};
